<html>

<head>
  <title>Input Form</title>
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.734.0.min.js"></script>
  <script src="https://unpkg.com/unfetch@4.1.0/dist/unfetch.umd.js"></script>
</head>

<body>
  <h1>Enter your information:</h1>
  <label>Universe:</label>
  <input type="text" id="universe"><br><br>
  <label>Character(s):</label>
  <input type="text" id="characters"><br><br>
  <label>Genre:</label>
  <input type="text" id="genre"><br><br>
  <button id="myButton">Submit</button>
  <label id="result"></label>
  <script type="text/javascript">
    AWS.config.update({
      region: 'us-east-1'
    });
    async function submitForm() {
      console.log("Got here!")
      document.getElementById("result").textContent = "Loading...";
      var universe = document.getElementById("universe").value;
      var characters = document.getElementById("characters").value;
      var genre = document.getElementById("genre").value;
      prompt = `Q: Please create a summary of a fanfiction from the ${universe} fictional universe with the characters ${characters} in the ${genre} genre. A:`;
      fanfic = await makeCompletionRequest(prompt);
      document.getElementById("result").textContent = fanfic;
      alert(fanfic);
      console.log(fanfic)
    }
    async function makeCompletionRequest(prompt) {
      console.log("Got to the request")
      const endpoint = 'https://lxqqwnn8jl.execute-api.us-east-1.amazonaws.com/prod/';

      const options = {
        method: 'POST',
        body: JSON.stringify({
          prompt: prompt
        })
      };

      try {
        const response = await fetch(endpoint, options);
        const json = await response.json();
        return json.completion;
      } catch (error) {
        console.error(error);
        return '';
      }
    }

    document.getElementById('myButton').addEventListener('click', async () => {
      await submitForm();
    });
  </script>
</body>
</html>
